YUI.add("aquinama-list",function(D){D.namespace("AquiNaMa");var C="contentBox",B=D.Base.create("aquinama-list",D.Widget,[D.WidgetParent],{CONTENT_TEMPLATE:"<div>"+'<ul class="yui3-aquinama-list-control yui3-aquinama-list-control-order"></ul>'+'<ul class="yui3-aquinama-list-control yui3-aquinama-list-control-tags"></ul>'+'<div class="yui3-aquinama-list-info">'+'<span>Mostrando <span class="yui3-aquinama-list-sizefilter"></span> art&iacute;culos de <span class="yui3-aquinama-list-total"></span></span>'+'<img class="yui3-aquinama-list-load" src="assets/images/ajax-loader-orange.gif"/>'+"</div>"+'<ul class="yui3-aquinama-list-container"></ul>'+'<div class="yui3-aquinama-list-more">Ver mas Resultados</div>'+"</div>",initializer:function(F){var E=this;E._publishEvents();},renderUI:function(){var E=this,F=E.get(C),H=F.one(".yui3-aquinama-list-control-order");modellist=E.get("emodellist");modellist.each(function(J){J.set("passfilter",true);});var I=new A({astate:"normal",aorder:"asc",aname:"price",atext:"Precio"});I.render(H);I.addTarget(E);E.set("aprice",I);var G=new A({astate:"desc",aorder:"desc",aname:"date",atext:"Fecha"});G.render(H);G.addTarget(E);E.set("adate",G);},bindUI:function(){var E=this,G=E.get("emodellist"),F=E.get(C);E.after("emodellistChange",E.syncUI);E.after("evisiblelistChange",E._handlerFilter);E.after("tagsChange",E.createTags);E.on("aquinama-sort-button:change",E._sortingBehavior);E.after("removeChild",function(H){F.one(".yui3-aquinama-list-sizefilter").set("text",E.get("emodellist").size());});F.one(".yui3-aquinama-list-more").on("click",function(H){E.showLoad();E.fire("aquinama-list:more");});},syncUI:function(){var E=this,F=E.get(C),H=E.get("emodellist"),I=true,G;E.removeAll();H.each(function(K,J){G=new D.AquiNaMa.Item({emodel:K});E.add(G);F.one("ul.yui3-aquinama-list-container").appendChild(G.get("boundingBox"));G.render();});F.one(".yui3-aquinama-list-sizefilter").set("text",H.size());F.one(".yui3-aquinama-list-total").set("text",E.get("atotal"));if(H.get("name")==="interest"){F.one(".yui3-aquinama-list-more").addClass("yui3-aquinama-hidden");F.one(".yui3-aquinama-list-control-tags").empty();}else{F.one(".yui3-aquinama-list-more").removeClass("yui3-aquinama-hidden");}E.hideLoad();E._togglePaint();},createTags:function(){var E=this,F=E.get(C),H,G=F.one(".yui3-aquinama-list-control-tags");G.empty();D.each(E.get("tags"),function(I){H=D.Node.create('<li class="yui3-aquinama-button-tags">'+I.name+"</li>");G.appendChild(H);});F.all(".yui3-aquinama-button-tags").on("click",E._handlerTags,E);},_handlerTags:function(F){var E=this;if(F.currentTarget.hasClass("yui3-aquinama-button-down")){F.currentTarget.removeClass("yui3-aquinama-button-down");}else{F.currentTarget.addClass("yui3-aquinama-button-down");}E.fire("aquinama-list:tags",{data:{name:F.currentTarget.getHTML()}});},_togglePaint:function(){var E=this,F=true;E.each(function(H,G){if(!H.get("boundingBox").hasClass("yui3-aquinama-hidden")){if(F){H.get("boundingBox").addClass("yui-3-aquinama-item-color");F=false;}else{H.get("boundingBox").removeClass("yui-3-aquinama-item-color");F=true;}}});},_publishEvents:function(){var E=this;E.publish("sort",{emitFacade:true,broadcast:1});E.publish("interest",{emitFacade:true,broadcast:1});E.publish("more",{emitFacade:true,broadcast:1});E.publish("tags",{emitFacade:true,broadcast:1});},source:function(){var E=this,G=E.get("emodellist"),F=[];G.each(function(H){F.push({model:H,tags:H.get("tittle")});});return F;},_handlerFilter:function(){var E=this,I=true,G=E.get("evisiblelist"),H=E.get("emodellist"),F=E.get(C);E.each(function(K,J){K.get("emodel").set("passfilter",false);});D.Array.each(G,function(J){J.raw.model.set("passfilter",true);J.raw.model.set("highlight",J.highlighted);});E._togglePaint();F.one(".yui3-aquinama-list-sizefilter").set("text",E.get("evisiblelist").length);if(G.length<10&&H.get("name")!=="interest"){E.showLoad();E.fire("aquinama-list:more");}},_sortingBehavior:function(H){var E=this,F=E.get(C),G=E.get("emodellist");if(H.name==="price"){E.get("adate").set("astate","normal");}else{E.get("aprice").set("astate","normal");}G.mySort(H.name,H.state);E.syncUI();F.one(".yui3-aquinama-list-sizefilter").set("text",E.get("evisiblelist").length);E.fire("aquinama-list:sort");},hideLoad:function(){var E=this,F=E.get(C);F.one(".yui3-aquinama-list-load").addClass("yui3-aquinama-hidden");},showLoad:function(){var E=this,F=E.get(C);F.one(".yui3-aquinama-list-load").removeClass("yui3-aquinama-hidden");},clearList:function(){var E=this,F=E.get(C),G=F.one(".yui3-aquinama-list-control-tags");G.empty();E.removeAll();},getActiveTags:function(){var E=this,G=E.get(C).all(".yui3-aquinama-list-control-tags .yui3-aquinama-button-down"),F="";D.each(G,function(H){F=F+H.getHTML()+",";});F=F.substring(0,F.length-1);return F;},changeMoreTex:function(G){var E=this,F=E.get(C);F.one(".yui3-aquinama-list-more").set("innerHTML",G);}},{ATTRS:{emodellist:{value:new D.ModelList()},evisiblelist:{value:[]},tags:{value:[]},aprice:{value:null},adate:{value:null},atotal:{value:0}}});D.AquiNaMa.List=B;var A=D.Base.create("aquinama-sort-button",D.Widget,[D.WidgetParent],{CONTENT_TEMPLATE:'<div><span class="yui3-aquinama-sort-button-text"></span><div class="yui3-aquinama-sort-button-img"></div><div class="yui3-aquinama-clear"></div></div>',initializer:function(F){var E=this;E._publishEvents();},renderUI:function(){var E=this;},bindUI:function(){var E=this,F=E.get(C);F.on("click",E._handlerClick,E);F.on("mouseover",E._handlerOver,E);F.on("mouseleave",E._handlerLeave,E);E.after("astateChange",E.syncUI);},syncUI:function(){var E=this,F=E.get(C),G=E.get("astate");F.one(".yui3-aquinama-sort-button-text").set("text",E.get("atext"));F.removeClass("yui3-aquinama-sort-button-asc");F.removeClass("yui3-aquinama-sort-button-desc");F.removeClass("yui3-aquinama-sort-button-normal");F.addClass("yui3-aquinama-sort-button-"+G);},_publishEvents:function(F){var E=this;E.publish("change",{emitFacade:true,broadcast:1});},_handlerClick:function(H){var E=this,F=E.get(C),G=E.get("astate");
if(G==="asc"){E.set("astate","desc");}else{if(G==="desc"){E.set("astate","asc");}else{E.set("astate",E.get("aorder"));}}E.fire("aquinama-sort-button:change",{state:E.get("astate"),name:E.get("aname")});},_handlerOver:function(H){var E=this,F=E.get(C),G=E.get("astate");if(G==="asc"){F.replaceClass("yui3-aquinama-sort-button-asc","yui3-aquinama-sort-button-desc");}else{if(G==="desc"){F.replaceClass("yui3-aquinama-sort-button-desc","yui3-aquinama-sort-button-asc");}else{F.replaceClass("yui3-aquinama-sort-button-normal","yui3-aquinama-sort-button-"+E.get("aorder"));}}},_handlerLeave:function(H){var E=this,F=E.get(C),G=E.get("astate");if(G==="asc"){F.replaceClass("yui3-aquinama-sort-button-desc","yui3-aquinama-sort-button-asc");}if(G==="desc"){F.replaceClass("yui3-aquinama-sort-button-asc","yui3-aquinama-sort-button-desc");}else{F.replaceClass("yui3-aquinama-sort-button-"+E.get("aorder"),"yui3-aquinama-sort-button-normal");}E.syncUI();}},{ATTRS:{astate:{value:"asc"},aorder:{value:"asc"},atext:{value:""},aname:{value:""}}});},"@VERSION@",{skinnable:true,requires:["base","widget","widget-parent","aquinama-item","recordset-sort"]});