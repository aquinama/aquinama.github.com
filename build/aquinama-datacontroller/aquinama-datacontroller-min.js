YUI.add("aquinama-datacontroller",function(F){F.namespace("AquiNaMa");var A="literal",B="loadedData",H="latestSearch",C="retrieve",G="search.total",D="interest",E=F.Base.create("aquinama-datacontroller",F.Base,[],{initializer:function(J){var I=this,K;K=new F.AquiNaMa.Literal({model:J.model});I.set(A,K);I._setupCache();I._setupRetrieves();I._publishEvents();I._bind();I.setupList();},_setupRetrieves:function(){var I=this,K,J={},M="",L;F.each(enableRetrieves,function(N){L=retrieves[N];M=L.objectName;K=new F.AquiNaMa[M]({model:I.get(A),name:N,globalConfig:L});J[M]=K;});I.set(C,J);},setupList:function(){var I=this,J=new F.AquiNaMa.ArticleList({name:B});I.set(B,J);J=new F.AquiNaMa.ArticleList({name:H});I.set(H,J);J=new F.AquiNaMa.ArticleList({name:D,source:I.get("cache"),behavior:"stack"});J.load();I.set(D,J);},_bind:function(){var I=this;I.on("activeRetrieve:categoryRetrieve",I._categoryRetrieveHandle,I);I.on("activeRetrieve:more",I._moreHandle,I);I.on("activeRetrieve:articleRetrieve",I._articleRetrieveHandle,I);I.on("activeRetrieve:error",I._errorRetrieveHandle,I);},_moreHandle:function(J){var I=this;I.get(B).add(J.data.result);I.get(H).add(J.data.result);I.fire("aquinama-datacontroller:more",{data:I.get(B)});},_categoryRetrieveHandle:function(L){var I=this,J,K=L.data;I.get(B).add(K.result);I.get(H).add(K.result);J=K.search.totalArticles+I.get(G);I.set(G,J);I.fire("aquinama-datacontroller:categoryRetrieve",{data:I.get(B)});},_articleRetrieveHandle:function(I){this.fire("aquinama-datacontroller:articleRetrieve",{data:I.data});},_errorRetrieveHandle:function(I){this.fire("aquinama-datacontroller:error",{data:I.data});},_publishEvents:function(){var I=this;F.each(I.get(C),function(J){J.addTarget(I);});I.publish("categoryRetrieve",{emitFacade:true,broadcast:1});I.publish("articleRetrieve",{emitFacade:true,broadcast:1});I.publish("error",{emitFacade:true,broadcast:1});I.publish("more",{emitFacade:true,broadcast:1});},_setupCache:function(){var I=new F.CacheOffline({sandbox:"6-hr-cache"});this.set("cache",I);},getData:function(J){var I=this,K=J[0].retrieve;if(K){I.get(C)[K].getData(J);I.get(C)[K].addTarget(J[0].model);}else{F.each(I.get(C),function(L){L.getData(J);});I.set(G,0);}},resetList:function(){this.get(B).reset();this.get(H).reset();},saveSearchResult:function(J){var I=this,L=J.filter,K={key:"1",text:I.createSearchText(L),value:J.result,filter:L,date:new Date()};I.get("latestSearch").add(K);},createSearchKey:function(J){var I="";F.each(J,function(K){I+=K.attr+"="+K.value+"&";});return I;},createSearchText:function(J){var I="",L="",K="";F.each(J,function(M){if(M.attr==="text"){L=M.value;}if(M.attr==="category"){K=M.value;}});if(L!==""){I=L+" en ";if(K!==""){I+=K+".";}else{I+="todo el sitio.";}}else{if(K!==""){I=K;}}return I;},addInterest:function(I){this.get(D).add(I);},notInterest:function(J){var I=this;I.get(D).remove(J);I.get(D).save();},more:function(){var I=this;F.each(I.get(C),function(J){J.more();});},tags:function(K){var I=this,J={},L=I.get(A).getAttr(K);J=I.get(A).walkToRoot(L,J,"tags");return J;}},{ATTRS:{retrieve:{value:[]},loadedData:{value:[]},latestSearch:{value:[]},interest:{value:[]},cache:{value:{}},search:{value:{total:0}},literal:{value:{}}}});F.AquiNaMa.DataController=E;},"@VERSION@",{skinnable:false,requires:["base","event","cache-offline","model","aquinama-articlelist","aquinama-searchlist","aquinama-revolretrieve","aquinama-cubretrieve","aquinama-literal"]});