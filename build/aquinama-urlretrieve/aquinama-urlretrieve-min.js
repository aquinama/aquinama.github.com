YUI.add("aquinama-urlretrieve",function(D){D.namespace("AquiNaMa");var C='select * from html where url="',P="_categoryRetrieve",M="_articleRetrieve",G="name",Q="model",A="urlBase",O="totalPages",L="actualPage",S="actualUrl",R="globalConfig",N="more",F="No mas resultados",E=D.Base.create("aquinama-urlretrieve",D.AquiNaMa.Retrieve,[],{initializer:function(W){var T=this,V=T.get("name"),U=T.get(Q).getAttr(V).url[V];U=U.substring(0,U.length-1);T.set(A,U);T._urlBind();},_urlBind:function(){var T=this;T.after("_bind",function(){T.after("actualUrlChange",function(U){T.set("actualPage",1);T.set("totalArticle",0);},T);},T);},retrieveData:function(V){var T=this,a=V.query,Z=V.eventPrefix,Y,U,X={msg:"",code:null},W=V.repeat;Y=D.YQL(a,{allowCache:false,on:{success:function(b){U=T.get(Q).getAttr(F,b);if(U){if(!T.againRetrieveData(W,V)){}}else{if(b.query.results){T.fire(Z,{data:{result:b.query.results,filter:V.filter}});}else{if(!T.againRetrieveData(W,V)){X.code=1;T.fire(F,{data:{error:X}});}}}},failure:function(b){if(!T.againRetrieveData(W,V)){X.code=0;T.fire(AR_E_EV,{data:{error:X}});}}}});},getCategory:function(T,U){if(T){this.categoryRetrieve(T,U);}else{return false;}},categoryRetrieve:function(V,W){var T=this,U=T.get(G),Z=retrieves[U].querys,X=[C,V,Z.categoryBase],Y;X=X.join("");if(test){D.later(1000,D,function(a){T.fire(P,{data:{result:appTest[U].category.query.results,filter:W}});});}else{if(!T.get("more")){Y=[X,Z.categoryFirst];X=Y.join("");}else{Y=[X,Z.categoryMore];X=Y.join("");}T.retrieveData({query:X,eventPrefix:P,filter:W,repeat:{max:3,actual:0}});}},getArticle:function(U){var T=this;T.articleRetrieve(U);},articleRetrieve:function(W){var T=this,X,V=T.get(G),U=W[0].value;if(test){D.later(1000,T,function(){T.fire(M,{data:{result:appTest[V].article.query.results,filter:W}});});}else{X=[C,U,retrieves[V].querys.article];X=X.join("");T.retrieveData({query:X,eventPrefix:M,filter:W,repeat:{max:3,actual:0}});}},buildUrl:function(X){var T=this,W,V="",U=["url.",T.get(G)];U=U.join("");W=T.get(Q).getAttr(X);if(W){return T.get(Q).walkToRoot(W,V,U);}else{}return false;},buildUrlbyFilter:function(W,Z){var U=this,T,V="",Y=Z.length,X,a;for(X=0;X<Y;X++){a=Z[X];T=U.get(Q).getAttr("attr",a);if(T){if(U[T]){if(T!="category"){V+=U[a.attr](a.value);}}else{}}else{}}return V;},category:function(V,W){var T=this,U="";T.set(N,false);U=T.buildUrl(V);if(U){U+=T.get(R).url.category+T.buildUrlbyFilter(U,W);}T.set(S,U);T.getCategory(U,W);},min:function(T,U){return"";},max:function(T,U){return"";},count:function(U,T){this.set("count",U);return"";},article:function(U,T){this.getArticle(T);},more:function(V){var T=this,U=T.get(S),X=T.get(O),Y=T.get(L),Z="",W=T.get("actualFilter");if(U!==""){X=5;if(Y<X){Y++;Z=T.nextUrl(Y,U,W);T.set(N,true);T.getCategory(Z,W);}else{T.fire(F,{data:{error:{code:2,msg:""}}});}}T.set(L,Y);},defaultFilter:function(Z){var U=this,W=U.buildUrl("1")+U.get(R).url.defaultSearch,T,V,Y=Z.length,X,a;for(X=0;X<Y;X++){a=Z[X];T=U.get(Q).getAttr("attr",a);if(T){if(U[T]){if(T!="category"){V=U[a.attr](a.value);if(V){W+=V;}else{return false;}}}else{}}else{}}U.set(S,W);U.getCategory(W,Z);return W;}},{ATTRS:{actualPage:{value:0},name:{value:""},urlBase:{value:""},count:{value:100},actualUrl:{value:""},totalPages:{value:5},more:{value:false},url:{value:{}},date:{value:{"Septiembre":"September","Octubre":"October","Noviembre":"November","Diciembre":"December","Enero":"January","Febrero":"Frebuary","Marzo":"March","Abril":"April","Mayo":"May","Junio":"June","Julio":"July","Agosto":"August"}},globalConfig:{value:{}}}});D.AquiNaMa.UrlRetrieve=E;var I=D.DataSchema.JSON,H=D.Lang,B=H.isFunction,J=H.isArray,K=D.DataSchema.Base;I._parseResults=function(Y,T,X){var U=I.getPath,V=I.getLocationValue,Z=U(Y.resultListLocator),W=Z?(V(Z,T)||T[Y.resultListLocator]):T;if(J(W)){if(J(Y.resultFields)){X=I._getFieldValues.call(this,Y.resultFields,W,X,Y);}else{X.results=W;}}else{if(Y.resultListLocator){X.results=[];X.error=new Error("JSON results retrieval failure");}}return X;};I._getFieldValues=function(e,a,Y,d){var g=[],l=e.length,k,h,T,n,X,c,W,o,f=[],m=[],Z=[],b,V;for(k=0;k<l;k++){T=e[k];n=T.key||T;X=T.locator||n;c=I.getPath(X);if(c){if(c.length===1){f.push({key:n,path:c[0]});}else{m.push({key:n,path:c,locator:X});}}else{}W=(B(T.parser))?T.parser:D.Parsers[T.parser+""];if(W){Z.push({key:n,parser:W});}}for(k=a.length-1;k>=0;--k){V={};b=a[k];if(b){for(h=m.length-1;h>=0;--h){c=m[h];o=I.getLocationValue(c.path,b);if(o===undefined){o=I.getLocationValue([c.locator],b);if(o!==undefined){f.push({key:c.key,path:c.locator});m.splice(k,1);continue;}}V[c.key]=K.parse.call(this,(I.getLocationValue(c.path,b)),c);}for(h=f.length-1;h>=0;--h){c=f[h];V[c.key]=K.parse.call(this,((b[c.path]===undefined)?b[h]:b[c.path]),c);}for(h=Z.length-1;h>=0;--h){n=Z[h].key;V[n]=Z[h].parser.call(this,V[n]);if(V[n]===undefined){V[n]=null;}}if(d.hasOwnProperty("filterRecord")&&B(d.filterRecord)){var U=this;if(d.context){U=d.context;}V=d.filterRecord.call(U,V,d);}g[k]=V;}}Y.results=g;if(d.hasOwnProperty("container")){Y.container=d.container;}return Y;};D.DataSchema.JSON=I;},"@VERSION@",{skinnable:false,requires:["base","yql","model-list","aquinama-articlemodel","datatype-date","aquinama-retrieve","dataschema-json"]});