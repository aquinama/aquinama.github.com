YUI.add("aquinama-list",function(C){C.namespace("AquiNaMa");var B="contentBox",A=C.Base.create("aquinama-list",C.Widget,[C.WidgetParent],{CONTENT_TEMPLATE:"<div>"+'<img class="yui3-aquinama-list-load" src="assets/images/ajax-loader-orange.gif"/>'+'<ul class="yui3-aquinama-list-control yui3-aquinama-list-control-order">'+'<li class="yui3-aquinama-button-up yui3-aquinama-list-control-price">Precio<div></div></li>'+'<li class="yui3-aquinama-list-latest yui3-aquinama-button-down yui3-aquinama-button-order-desc">Fecha<div></div></li>'+"</ul>"+'<ul class="yui3-aquinama-list-control yui3-aquinama-list-control-tags">'+"</ul>"+'<ul class="yui3-aquinama-list-container"></ul>'+'<div class="yui3-aquinama-list-more">Ver mas Resultados</div>'+"</div>",initializer:function(E){var D=this;D._publishEvents();},renderUI:function(){var D=this,E=D.get("emodellist");E.each(function(F){F.set("passfilter",true);});},bindUI:function(){var D=this,F=D.get("emodellist"),E=D.get(B);D.after("emodellistChange",D.syncUI);D.after("evisiblelistChange",D._handlerFilter);D.after("tagsChange",D.createTags);E.one(".yui3-aquinama-list-more").on("click",function(G){D.showLoad();D.fire("aquinama-list:more");});E.one(".yui3-aquinama-list-control-price").on("click",D._handlerPrice,D);E.one(".yui3-aquinama-list-latest").on("click",D._handlerDate,D);},syncUI:function(){var D=this,E=D.get(B),G=D.get("emodellist"),H=true,F;D.removeAll();G.each(function(J,I){F=new C.AquiNaMa.Item({emodel:J});D.add(F);E.one("ul.yui3-aquinama-list-container").appendChild(F.get("boundingBox"));F.render();});D.hideLoad();D._togglePaint();},createTags:function(){var D=this,E=D.get(B),G,F=E.one(".yui3-aquinama-list-control-tags");F.empty();C.each(D.get("tags"),function(H){G=C.Node.create('<li data-tags="'+H.alias+'" class="yui3-aquinama-button-tags">'+H.name+"</li>");F.appendChild(G);});E.all(".yui3-aquinama-button-tags").on("click",D._handlerTags,D);},_animOrder:function(E){var D=this;E.target.one("div").transition({easing:"ease-out",duration:0.2,width:"13px",height:"13px"},function(){});},_animOrderReverse:function(E){var D=this;E.target.one("div").transition({easing:"ease-out",duration:0.2,width:"0px",height:"0px"},function(){});},_handlerTags:function(E){var D=this;if(E.currentTarget.hasClass("yui3-aquinama-button-down")){E.currentTarget.removeClass("yui3-aquinama-button-down");}else{E.currentTarget.addClass("yui3-aquinama-button-down");}D.fire("aquinama-list:tags",{data:{name:E.currentTarget.getHTML(),tags:E.currentTarget.getAttribute("data-tags")}});},_togglePaint:function(){var D=this,E=true;D.each(function(G,F){if(!G.get("boundingBox").hasClass("yui3-aquinama-hidden")){if(E){G.get("boundingBox").addClass("yui-3-aquinama-item-color");E=false;}else{G.get("boundingBox").removeClass("yui-3-aquinama-item-color");E=true;}}});},_publishEvents:function(){var D=this;D.publish("sort",{emitFacade:true,broadcast:1});D.publish("interest",{emitFacade:true,broadcast:1});D.publish("more",{emitFacade:true,broadcast:1});D.publish("tags",{emitFacade:true,broadcast:1});},source:function(){var D=this,F=D.get("emodellist"),E=[];F.each(function(G){E.push({model:G,tags:G.get("tittle")});});return E;},_handlerFilter:function(){var D=this,G=true,F=D.get("evisiblelist"),E=D.get(B);D.each(function(I,H){I.get("emodel").set("passfilter",false);});C.Array.each(F,function(H){H.raw.model.set("passfilter",true);H.raw.model.set("highlight",H.highlighted);});D._togglePaint();if(F.length<10){D.showLoad();D.fire("aquinama-list:more");}},_sortingBehavior:function(E,H){var D=this,F=D.get(B),G=D.get("emodellist");if(H.currentTarget.hasClass("yui3-aquinama-button-up")){C.each(F.all(".yui3-aquinama-list-control-order li"),function(I){if(I.hasClass("yui3-aquinama-button-down")){I.replaceClass("yui3-aquinama-button-down","yui3-aquinama-button-up");}});H.currentTarget.replaceClass("yui3-aquinama-button-up","yui3-aquinama-button-down");H.currentTarget.addClass("yui3-aquinama-button-order-asc");G.mySort(E,"asc");}else{if(H.currentTarget.hasClass("yui3-aquinama-button-order-asc")){H.currentTarget.replaceClass("yui3-aquinama-button-order-asc","yui3-aquinama-button-order-desc");G.mySort(E,"desc");}else{if(H.currentTarget.hasClass("yui3-aquinama-button-order-desc")){H.currentTarget.replaceClass("yui3-aquinama-button-order-desc","yui3-aquinama-button-order-asc");G.mySort(E,"asc");}}}D.syncUI();D.fire("aquinama-list:sort");},_handlerPrice:function(E){var D=this;D._sortingBehavior("price",E);},_handlerDate:function(E){var D=this;D._sortingBehavior("date",E);},hideLoad:function(){var D=this,E=D.get(B);E.one(".yui3-aquinama-list-load").addClass("yui3-aquinama-hidden");},showLoad:function(){var D=this,E=D.get(B);E.one(".yui3-aquinama-list-load").removeClass("yui3-aquinama-hidden");},getActiveTags:function(){var D=this,F=D.get(B).all(".yui3-aquinama-list-control-tags .yui3-aquinama-button-down"),E="";C.each(F,function(G){E=E+G.getHTML()+",";});E=E.substring(0,E.length-1);return E;},changeMoreTex:function(F){var D=this,E=D.get(B);E.one(".yui3-aquinama-list-more").set("innerHTML",F);}},{ATTRS:{emodellist:{value:new C.ModelList()},evisiblelist:{value:[]},tags:{value:[]}}});C.AquiNaMa.List=A;},"@VERSION@",{skinnable:true,requires:["base","widget","widget-parent","aquinama-item","recordset-sort"]});