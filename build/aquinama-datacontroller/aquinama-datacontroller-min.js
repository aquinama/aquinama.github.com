YUI.add("aquinama-datacontroller",function(E){E.namespace("AquiNaMa");var B=E.Lang,A=B.isString,C=B.isNumber,D=E.Base.create("aquinama-datacontroller",E.Base,[],{initializer:function(G){var F=this;F._setupCache();F.set("retrieve",G.retrieve);F._publishEvents();F._bind();F.setupList();},setupList:function(){var F=this,G=new E.AquiNaMa.ArticleList({name:"loadedData"});if(test){}F.set("loadedData",G);G=new E.AquiNaMa.ArticleList({name:"interest",source:F.get("cache"),behavior:"stack"});G.load();F.set("interest",G);G=new E.AquiNaMa.SearchList({name:"latestSearch",source:F.get("cache"),behavior:"stack",max:10});G.load();F.set("latestSearch",G);},_bind:function(){var F=this;F.on("activeRetrieve:categoryRetrieve",F._categoryRetrieveHandle,F);F.on("activeRetrieve:more",F._moreHandle,F);F.on("activeRetrieve:articleRetrieve",F._articleRetrieveHandle,F);F.on("activeRetrieve:error",F._errorRetrieveHandle,F);},_moreHandle:function(G){var F=this;F.get("loadedData").add(G.data.result);F.fire("aquinama-datacontroller:more",{data:F.get("loadedData")});},_categoryRetrieveHandle:function(G){var F=this;F.saveSearchResult(G.data);F.get("loadedData").reset(G.data.result);F.fire("aquinama-datacontroller:categoryRetrieve",{data:F.get("loadedData")});},_articleRetrieveHandle:function(G){var F=this;F.fire("aquinama-datacontroller:articleRetrieve",{data:G.data});},_errorRetrieveHandle:function(G){var F=this;F.fire("aquinama-datacontroller:error",{data:G.data});},_publishEvents:function(){var F=this;E.each(F.get("retrieve"),function(G){G.addTarget(F);});F.publish("categoryRetrieve",{emitFacade:true,broadcast:1});F.publish("articleRetrieve",{emitFacade:true,broadcast:1});F.publish("error",{emitFacade:true,broadcast:1});F.publish("more",{emitFacade:true,broadcast:1});},_setupCache:function(){var F=this,G=new E.CacheOffline({sandbox:"6-hr-cache"});F.set("cache",G);},getData:function(H){var F=this,G="";if(H[0].retrieve){F.get("retrieve")[H[0].retrieve].getData(H);F.get("retrieve")[H[0].retrieve].addTarget(H[0].model);}else{E.each(F.get("retrieve"),function(I){I.getData(H);});}},saveSearchResult:function(G){var F=this,H={key:"1",text:F.createSearchText(G.filter),value:G.result,filter:G.filter,date:new Date()};F.get("latestSearch").add(H);},createSearchKey:function(H){var F=this,G="";E.each(H,function(I){G+=I.attr+"="+I.value+"&";});return G;},createSearchText:function(H){var G=this,F="",J="",I="";E.each(H,function(K){if(K.attr==="text"){J=K.value;}if(K.attr==="category"){I=K.value;}});if(J!==""){F=J+" en ";if(I!==""){F+=I+".";}else{F+="todo el sitio.";}}else{if(I!==""){F=I;}}return F;},addInterest:function(G){var F=this;F.get("interest").add(G);G.loadContent();},notInterest:function(G){var F=this;F.get("interest").remove(G);},more:function(){var F=this;E.each(F.get("retrieve"),function(G){G.more();});}},{ATTRS:{retrieve:{value:[]},loadedData:{value:[]},latestSearch:{value:[]},interest:{value:[]},cache:{value:{}}}});E.AquiNaMa.DataController=D;},"@VERSION@",{skinnable:false,requires:["base","event","cache-offline","model","aquinama-articlelist","aquinama-searchlist"]});