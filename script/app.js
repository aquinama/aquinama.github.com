YUI().use("event","aquinama-datacontroller","aquinama-revolretrieve","aquinama-literal","aquinama-search","aquinama-list","aquinama-tools","history-hash",function(b){var a={},d='El buscador de anuncios *F&aacute;cil y R&aacute;pido*</br></br><img src="assets/images/patineta.png" title="Una patineta seg&uacute;n FQM ...">',c="";hero=b.one("#yui3-aquinama-all-desc");a.tree=appTree;a.model=appTree;a.error=error;a.history=new b.History({initialState:{act:"init"}});a.interestView=function(){a.busqueda.deselect();a.interest.get("contentBox").addClass("yui3-aquinama-interest-focus");b.one("#yui3-aquinama-news").addClass("yui3-aquinama-hidden");b.one("#yui3-aquinama-list").removeClass("yui3-aquinama-hidden");a.list.showLoad();a.list.set("emodellist",a.datacontroller.get("interest"));a.filter.set("source",a.list.source());a.filter.clear();a.filter.sendRequest();a.search.setCategory("Me Interesan");b.one("#yui3-aquinama-error").set("innerHTML","")};a.mainView=function(){b.one(".loading-main").addClass("yui3-aquinama-hidden");b.one(".loading-main2").addClass("yui3-aquinama-hidden");hero.addClass("graylow");hero.setHTML(d);b.one("#yui3-aquinama-all-desc2").setHTML(c)};a.initView=function(){b.one("#yui3-aquinama-news").removeClass("yui3-aquinama-hidden");b.one("#yui3-aquinama-list").addClass("yui3-aquinama-hidden");a.interest.deselect();a.busqueda.get("contentBox").addClass("yui3-aquinama-interest-focus");a.search._clearSearch();a.search._syncSearch()};a.searchView=function(g){var e=a.datacontroller.get("latestSearch"),f=e.size();a.interest.deselect();a.busqueda.get("contentBox").addClass("yui3-aquinama-interest-focus");if(a.search.get("lastaselect")){a.search.searchCategory(a.search.get("lastaselect"))}else{a.initView()}};a.Search=function(g){var f=g.filter;b.one("#yui3-aquinama-news").addClass("yui3-aquinama-hidden");b.one("#yui3-aquinama-list").removeClass("yui3-aquinama-hidden");a.list.changeMoreTex("Ver mas resultados");a.list.clearList();a.filter.clear();if(f[0].value!=="Me Interesan"){a.history.add({category:f[0].value,act:"search"})}a.interest.deselect();a.busqueda.get("contentBox").addClass("yui3-aquinama-interest-focus");a.list.showLoad();a.datacontroller.resetList();if(f[0].attr==="text"&&f[0].value==="Me Interesan"){a.interestView()}else{a.datacontroller.getData(f);a.interest.deselect()}b.one("#yui3-aquinama-error").set("innerHTML","")};a.Error=function(h){if(h.data.error.code===2){var g=a.search.get("aselect"),f=a.tree[a.search.get("aselect")];if(f){g=f.name}a.list.changeMoreTex(a.error[2].msg+" "+a.filter.get("query")+" "+a.list.getActiveTags()+" en "+g);a.list.hideLoad()}else{b.one("#yui3-aquinama-error").set("innerHTML","<p>"+a.error[h.data.error.code].msg)+"</p>";b.one("#yui3-aquinama-list").addClass("yui3-aquinama-hidden");a.search.clearSearch()}};a.categoryRetrieve=function(g){var f={};a.list.set("atotal",a.datacontroller.get("search.total"));a.list.set("emodellist",g.data);a.filter.set("source",a.list.source());a.filter.sendRequest();f=a.datacontroller.tags(a.search.get("aselect"));a.list.set("tags",f);a.filter.set("tags",f);a.filter.set("afilter",{});b.one("#yui3-aquinama-error").set("innerHTML","")};a.tagsHandle=function(f){a.filter.afilterPopulate(f.data);a.filter.sendRequest(a.filter.get("value"))};a.moreDataControllerHandle=function(f){a.list.set("emodellist",f.data);a.filter.set("source",a.list.source());a.filter.sendRequest(a.filter.get("query"))};a.Filter=function(f){a.list.set("evisiblelist",f.results)};a.Sort=function(f){a.filter.set("source",a.list.source());a.filter.sendRequest()};a.InterestMe=function(f){a.datacontroller.addInterest(f.model);a.interest.set("acount",a.datacontroller.get("interest").size())};a.NoInterestMe=function(f){a.datacontroller.notInterest(f.model);a.interest.set("acount",a.datacontroller.get("interest").size())};a.articleData=function(f){a.datacontroller.getData(f.data)};a.moreListHandle=function(f){a.datacontroller.more()};a.scrollDown=function(g){var f=a.body.scrollInfo.getOffscreenNodesBottom("li.yui3-aquinama-item");if(f.size()<20){a.list.moveItemsDown()}};a.search=new b.AquiNaMa.Search({boundingBox:"#yui3-aquinama-search",contentBox:"#yui3-aquinama-search div",acategorys:a.tree});a.search.render();a.datacontroller=new b.AquiNaMa.DataController({model:a.model});a.list=new b.AquiNaMa.List({boundingBox:"#yui3-aquinama-list"});a.list.render("#yui3-aquinama-left");a.interest=new b.AquiNaMa.Interest({acount:a.datacontroller.get("interest").size(),boundingBox:b.one(".yui3-aquinama-interest"),contentBox:b.one(".yui3-aquinama-interest")});a.busqueda=new b.AquiNaMa.Busqueda({boundingBox:b.one(".yui3-aquinama-busqueda"),contentBox:b.one(".yui3-aquinama-busqueda")});a.interest.render();a.busqueda.render();a.filter=new b.AquiNaMa.Filter({inputNode:a.search.get("contentBox").one(".yui3-aquinama-search-filter"),minQueryLength:0,queryDelay:300,resultTextLocator:"tags",});a.filter.set("source",a.list.source());a.body=b.one("body");a.body.plug(b.Plugin.ScrollInfo);b.on("aquinama-search:search",a.Search);a.filter.on("results",a.Filter);b.on("aquinama-list:sort",a.Sort);b.on("aquinama-list:tags",a.tagsHandle);b.on("aquinama-datacontroller:categoryRetrieve",a.categoryRetrieve);b.on("aquinama-datacontroller:more",a.moreDataControllerHandle);b.on("aquinama-datacontroller:error",a.Error);b.on("aquinama-item:interest",a.InterestMe);b.on("aquinama-item:no-interest",a.NoInterestMe);b.on("aquinama-articlemodel:articleData",a.articleData);b.on("aquinama-list:more",a.moreListHandle);b.on("history:change",a.historyHandle,this);a.body.scrollInfo.on("scrollDown",a.scrollDown);b.on("aquinama-search:clear",function(f){a.list.get("boundingBox").addClass("yui3-aquinama-hidden");b.one("#yui3-aquinama-news").removeClass("yui3-aquinama-hidden");a.interest.deselect();a.list.clearList();a.busqueda.get("contentBox").addClass("yui3-aquinama-interest-focus");a.history.add({act:"init",category:null})});b.one(".yui3-aquinama-interest").on("click",function(f){a.interestView();a.history.add({act:"interest"})});b.one(".yui3-aquinama-busqueda").on("click",function(f){a.searchView({});a.history.addValue("act","search")});b.on("history:change",function(g){var h=g.changed,f=g.removed;if(g.src===b.HistoryHash.SRC_HASH){if(h.act){if(h.act.newVal==="interest"){b.log("Me interesa");a.interestView()}else{if(h.act.newVal==="init"){b.log("inicio");a.initView()}else{if(h.act.newVal==="search"){b.log("search");a.searchView()}}}}if(h.category){b.log("cambio una categoria");a.interest.deselect();a.busqueda.get("contentBox").addClass("yui3-aquinama-interest-focus");a.search.searchCategory(h.category.newVal)}}});a.routing=function(){var e=b.HistoryHash.parseHash();if(e.act==="init"){}else{if(e.act==="interest"){a.interestView();a.history.add({act:"interest"})}else{if(e.act==="search"){if(e.category){a.search.searchCategory(e.category)}else{a.history.replace({act:"init"});a.initView()}}else{a.initView()}}}};a.routing();a.mainView();b.one(".go-top").on("click",function(f){window.scrollTo(0,0)})});