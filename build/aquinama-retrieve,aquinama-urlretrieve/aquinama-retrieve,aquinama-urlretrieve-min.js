YUI.add("aquinama-retrieve,aquinama-urlretrieve",function(B){B.namespace("AquiNaMa");var A=B.Base.create("aquinama-retrieve",B.Base,[],{initializer:function(E){var C=this,D;C.set("model",E.model);C._publishEvents();C._bind();},_publishEvents:function(){var C=this;C.publish("categoryRetrieve",{emitFacade:true,broadcast:1});C.publish("more",{emitFacade:true,broadcast:1});C.publish("articleRetrieve",{emitFacade:true,broadcast:1});C.publish("error",{emitFacade:true,broadcast:1});},_bind:function(){var D=this,E,C;D.on("_categoryRetrieve",D._categoryRetrieveHandle,D);D.on("_articleRetrieve",D._articleRetrieveHandle,D);D.fire("_bind");},_categoryRetrieveHandle:function(F){var D=this,E,C;E=D.get("model").getAttr("data",F);if(E){C=D.categoryParse(F.data);C=D.categoryFormat(C);if(C&&D.get("more")){D.fire("activeRetrieve:more",{data:{result:C,filter:F.data.filter}});}else{if(C){D.fire("activeRetrieve:categoryRetrieve",{data:{result:C,filter:F.data.filter,search:{totalArticles:D.get("totalArticle")}}});}}}else{D.fire("activeRetrieve:error",{data:{error:"CategoryRetrieve no ha retornado ningun dato"}});}},_articleRetrieveHandle:function(F){var D=this,E,C;C=D.articleParse(F.data);C=D.articleFormat(C);D.fire("activeRetrieve:articleRetrieve",{data:C,filter:F.data.filter});},getData:function(E){var D=this,C;D.set("actualFilter",E);if(E.length>0){if(E[0].attr!="category"&&E[0].attr!="article"){D.defaultFilter(E);}else{B.each(E,function(F){C=D.get("model").getAttr("attr",F);if(C){if(D[C]){D[F.attr](F.value,E);}else{}}else{}});}}else{}},retrieveData:function(E){var C=this,J=E.query,I=E.eventPrefix,H,D,G={msg:"",code:null},F=E.repeat;H=B.YQL(J,{allowCache:false,on:{success:function(K){D=C.get("model").getAttr("error",K);if(D){if(F.max<F.actual){F.actual++;E.repeat=F;C.retrieveData(E);}else{}}else{if(K.query.results){C.fire(I,{data:{result:K.query.results,filter:E.filter}});}else{if(F.max<F.actual){F.actual++;E.repeat=F;C.retrieveData(E);}else{G.code=1;C.fire("activeRetrieve:error",{data:{error:G}});}}}},failure:function(K){if(F.max<F.actual){F.actual++;E.repeat=F;C.retrieveData(E);}else{G.code=0;C.fire("activeRetrieve:error",{data:{error:G}});}}}});}},{ATTRS:{model:{value:{}},actualFilter:{value:{}}}});B.AquiNaMa.Retrieve=A;},"@VERSION@",{requires:["base"],skinnable:false});