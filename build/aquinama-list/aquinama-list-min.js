YUI.add("aquinama-list",function(D){D.namespace("AquiNaMa");var C="contentBox",B=D.Base.create("aquinama-sort-button",D.Widget,[D.WidgetParent],{CONTENT_TEMPLATE:'<div><span class="yui3-aquinama-sort-button-text"></span><div class="yui3-aquinama-sort-button-img"></div><div class="yui3-aquinama-clear"></div></div>',initializer:function(F){var E=this;E._publishEvents();},renderUI:function(){var E=this;},bindUI:function(){var E=this,F=E.get(C);F.on("click",E._handlerClick,E);F.on("mouseover",E._handlerOver,E);F.on("mouseleave",E._handlerLeave,E);E.after("astateChange",E.syncUI);},syncUI:function(){var E=this,F=E.get(C),G=E.get("astate");F.one(".yui3-aquinama-sort-button-text").set("text",E.get("atext"));F.removeClass("yui3-aquinama-sort-button-asc");F.removeClass("yui3-aquinama-sort-button-desc");F.removeClass("yui3-aquinama-sort-button-normal");F.addClass("yui3-aquinama-sort-button-"+G);},_publishEvents:function(F){var E=this;E.publish("change",{emitFacade:true,broadcast:1});},_handlerClick:function(H){var E=this,F=E.get(C),G=E.get("astate");if(G==="asc"){E.set("astate","desc");}else{if(G==="desc"){E.set("astate","asc");}else{E.set("astate",E.get("aorder"));}}E.fire("aquinama-sort-button:change",{state:E.get("astate"),name:E.get("aname")});},_handlerOver:function(H){var E=this,F=E.get(C),G=E.get("astate");if(G==="asc"){F.replaceClass("yui3-aquinama-sort-button-asc","yui3-aquinama-sort-button-desc");}else{if(G==="desc"){F.replaceClass("yui3-aquinama-sort-button-desc","yui3-aquinama-sort-button-asc");}else{F.replaceClass("yui3-aquinama-sort-button-normal","yui3-aquinama-sort-button-"+E.get("aorder"));}}},_handlerLeave:function(H){var E=this,F=E.get(C),G=E.get("astate");if(G==="asc"){F.replaceClass("yui3-aquinama-sort-button-desc","yui3-aquinama-sort-button-asc");}if(G==="desc"){F.replaceClass("yui3-aquinama-sort-button-asc","yui3-aquinama-sort-button-desc");}else{F.replaceClass("yui3-aquinama-sort-button-"+E.get("aorder"),"yui3-aquinama-sort-button-normal");}E.syncUI();}},{ATTRS:{astate:{value:"asc"},aorder:{value:"asc"},atext:{value:""},aname:{value:""}}});D.namespace("AquiNaMa");var C="contentBox",A=D.Base.create("aquinama-list",D.Widget,[D.WidgetParent],{CONTENT_TEMPLATE:"<div>"+'<ul class="yui3-aquinama-list-control yui3-aquinama-list-control-order"></ul>'+'<ul class="yui3-aquinama-list-control yui3-aquinama-list-control-tags"></ul>'+'<div class="yui3-aquinama-list-info">'+'<span>Mostrando <span class="yui3-aquinama-list-sizefilter"></span> art&iacute;culos de <span class="yui3-aquinama-list-total"></span></span>'+'<img class="yui3-aquinama-list-load" src="assets/images/ajax-loader-orange.gif"/>'+"</div>"+'<ul class="yui3-aquinama-list-container"></ul>'+'<div class="yui3-aquinama-list-more">Ver mas Resultados</div>'+"</div>",initializer:function(F){var E=this;E._publishEvents();},renderUI:function(){var E=this;E._renderItems();E._renderButtons();},bindUI:function(){var E=this,G=E.get("emodellist"),F=E.get(C);E.after("evisiblelistChange",E.syncUI);E.after("tagsChange",E.createTags);E.on("aquinama-sort-button:change",E._sortingBehavior);F.one(".yui3-aquinama-list-more").on("click",function(H){E.showLoad();E.fire("aquinama-list:more");});},syncUI:function(){var E=this,F=E.get(C),I=E.get("emodellist"),H=E.get("evisiblelist"),J=true,G;E._syncItems();E._syncInfo();E.hideLoad();if(I.get("name")==="interest"){F.one(".yui3-aquinama-list-more").addClass("yui3-aquinama-hidden");F.one(".yui3-aquinama-list-control-tags").empty();}else{F.one(".yui3-aquinama-list-more").removeClass("yui3-aquinama-hidden");if(H.length<10){E.showLoad();E.fire("aquinama-list:more");}}F.one("ul.yui3-aquinama-list-container").removeClass("yui3-aquinama-hidden");E._togglePaint();},_renderItems:function(){var E=this,F=E.get(C),G,H;for(G=0;G<40;G++){H=new D.AquiNaMa.Item();E.add(H);F.one("ul.yui3-aquinama-list-container").appendChild(H.get("boundingBox"));H.render();}},_renderButtons:function(){var E=this,F=E.get(C),H=F.one(".yui3-aquinama-list-control-order"),I=new B({astate:"normal",aorder:"asc",aname:"price",atext:"Precio"}),G=new B({astate:"desc",aorder:"desc",aname:"date",atext:"Fecha"});I.render(H);I.addTarget(E);E.set("aprice",I);G.render(H);G.addTarget(E);E.set("adate",G);},_syncItems:function(){var E=this,J=E.get("evisiblelist"),H=E.size(),G,F=0,I,K=new D.Model();for(G=0;G<H;G++){I=E.item(G);if(J[G]){I.set("emodel",J[G].raw.model);F++;}else{I.set("emodel",K);}}E.set("end",F);},_syncInfo:function(){var E=this,F=E.get(C);F.one(".yui3-aquinama-list-sizefilter").set("text",E.get("evisiblelist").length);F.one(".yui3-aquinama-list-total").set("text",E.get("atotal"));},createTags:function(){var J=this,I=J.get(C),E,H=I.one(".yui3-aquinama-list-control-tags"),F,L,M=J.get("tags"),G="",K="";H.empty();D.each(J.get("tags"),function(N){K='<li class="yui3-aquinama-button-tags" data-tags="'+N.id+'">'+N.name+"</li>";G=K+G;});H.setHTML(G);I.all(".yui3-aquinama-button-tags").on("click",J._handlerTags,J);},_handlerTags:function(F){var E=this;if(F.currentTarget.hasClass("yui3-aquinama-button-down")){F.currentTarget.removeClass("yui3-aquinama-button-down");}else{F.currentTarget.addClass("yui3-aquinama-button-down");}E.fire("aquinama-list:tags",{data:{name:F.currentTarget.getAttribute("data-tags")}});},_togglePaint:function(){var E=this,F=true;E.each(function(H,G){if(!H.get("boundingBox").hasClass("yui3-aquinama-hidden")){if(F){H.get("boundingBox").addClass("yui-3-aquinama-item-color");F=false;}else{H.get("boundingBox").removeClass("yui-3-aquinama-item-color");F=true;}}});},_publishEvents:function(){var E=this;E.publish("sort",{emitFacade:true,broadcast:1});E.publish("interest",{emitFacade:true,broadcast:1});E.publish("more",{emitFacade:true,broadcast:1});E.publish("tags",{emitFacade:true,broadcast:1});},source:function(){var E=this,G=E.get("emodellist"),F=[];G.each(function(H){F.push({model:H,tags:H.get("tittle")});});return F;},_handlerFilter:function(){var E=this,I=true,G=E.get("evisiblelist"),H=E.get("emodellist"),F=E.get(C);E.each(function(K,J){K.get("emodel").set("passfilter",false);
});D.Array.each(G,function(J){J.raw.model.set("passfilter",true);J.raw.model.set("highlight",J.highlighted);});E._togglePaint();F.one(".yui3-aquinama-list-sizefilter").set("text",E.get("evisiblelist").length);if(G.length<10&&H.get("name")!=="interest"){E.showLoad();E.fire("aquinama-list:more");}},_sortingBehavior:function(H){var E=this,F=E.get(C),G=E.get("emodellist");if(H.name==="price"){E.get("adate").set("astate","normal");}else{E.get("aprice").set("astate","normal");}G.mySort(H.name,H.state);F.one(".yui3-aquinama-list-sizefilter").set("text",E.get("evisiblelist").length);E.fire("aquinama-list:sort");},hideLoad:function(){var E=this,F=E.get(C);F.one(".yui3-aquinama-list-load").addClass("yui3-aquinama-hidden");},showLoad:function(){var E=this,F=E.get(C);F.one(".yui3-aquinama-list-load").removeClass("yui3-aquinama-hidden");},clearList:function(){var E=this,F=E.get(C),G=F.one(".yui3-aquinama-list-control-tags");G.empty();F.one("ul.yui3-aquinama-list-container").addClass("yui3-aquinama-hidden");},getActiveTags:function(){var E=this,G=E.get(C).all(".yui3-aquinama-list-control-tags .yui3-aquinama-button-down"),F="";D.each(G,function(H){F=F+H.getHTML()+",";});F=F.substring(0,F.length-1);return F;},changeMoreTex:function(G){var E=this,F=E.get(C);F.one(".yui3-aquinama-list-more").set("innerHTML",G);},moveItemsDown:function(){var E=this,G=E.get("end"),F=E.get(C),K=E.get("evisiblelist"),J,H,L=new D.Model(),I=0;for(var I=0;I<20;I++){H=G+I;if(K[H]){J=K[H].raw.model;if(E.item(H)){E.item(H).set("emodel",J);}else{J=new D.AquiNaMa.Item({emodel:J});F.one("ul.yui3-aquinama-list-container").appendChild(J.get("boundingBox"));J.render();E.add(J);if(!E.item(H-1).get("boundingBox").hasClass("yui-3-aquinama-item-color")){J.get("boundingBox").addClass("yui-3-aquinama-item-color");}}}else{if(E.item(H)){E.item(H).set("emodel",L);}else{break;}}}E.set("end",G+I);}},{ATTRS:{emodellist:{value:new D.ModelList()},evisiblelist:{value:[]},tags:{value:[]},aprice:{value:null},adate:{value:null},atotal:{value:0},end:{value:0}}});D.AquiNaMa.List=A;D.Plugin.ScrollInfo.prototype.getOffscreenNodesTop=function(E,I){if(typeof I==="undefined"){I=this._scrollMargin;}var H=this._lastScroll,G=this._host.all(E||"*"),J=H.scrollTop-I,F=this;return G.filter(function(L){var M=D.DOM.getXY(L),K=M[1]-F._top;if(K<J){return true;}return false;});};D.Plugin.ScrollInfo.prototype.getOffscreenNodesBottom=function(E,J){if(typeof J==="undefined"){J=this._scrollMargin;}var I=this._lastScroll,G=this._host.all(E||"*"),H=I.scrollBottom+J,F=this;return G.filter(function(L){var M=D.DOM.getXY(L),K=M[1]-F._top;if(K>H){return true;}return false;});};},"@VERSION@",{skinnable:true,requires:["base","widget","widget-parent","aquinama-item","recordset-sort","node-scroll-info"]});