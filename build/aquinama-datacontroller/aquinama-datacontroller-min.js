YUI.add("aquinama-datacontroller",function(F){F.namespace("AquiNaMa");var A="literal",B="loadedData",C="retrieve",G="search.total",D="interest",E=F.Base.create("aquinama-datacontroller",F.Base,[],{initializer:function(I){var H=this,J;J=new F.AquiNaMa.Literal({model:I.model});H.set(A,J);H._setupCache();H._setupRetrieves();H._publishEvents();H._bind();H.setupList();},_setupRetrieves:function(){var H=this,J,I={},L="",K;F.each(enableRetrieves,function(M){K=retrieves[M];L=K.objectName;J=new F.AquiNaMa[L]({model:H.get(A),name:M,globalConfig:K});I[L]=J;});H.set(C,I);},setupList:function(){var H=this,I=new F.AquiNaMa.ArticleList({name:B});H.set(B,I);I=new F.AquiNaMa.ArticleList({name:D,source:H.get("cache"),behavior:"stack"});I.load();H.set(D,I);},_bind:function(){var H=this;H.on("activeRetrieve:categoryRetrieve",H._categoryRetrieveHandle,H);H.on("activeRetrieve:more",H._moreHandle,H);H.on("activeRetrieve:articleRetrieve",H._articleRetrieveHandle,H);H.on("activeRetrieve:error",H._errorRetrieveHandle,H);},_moreHandle:function(I){var H=this;H.get(B).add(I.data.result);H.fire("aquinama-datacontroller:more",{data:H.get(B)});},_categoryRetrieveHandle:function(K){var H=this,I,J=K.data;H.get(B).add(J.result);I=J.search.totalArticles+H.get(G);H.set(G,I);H.fire("aquinama-datacontroller:categoryRetrieve",{data:H.get(B)});},_articleRetrieveHandle:function(H){this.fire("aquinama-datacontroller:articleRetrieve",{data:H.data});},_errorRetrieveHandle:function(H){this.fire("aquinama-datacontroller:error",{data:H.data});},_publishEvents:function(){var H=this;F.each(H.get(C),function(I){I.addTarget(H);});H.publish("categoryRetrieve",{emitFacade:true,broadcast:1});H.publish("articleRetrieve",{emitFacade:true,broadcast:1});H.publish("error",{emitFacade:true,broadcast:1});H.publish("more",{emitFacade:true,broadcast:1});},_setupCache:function(){var H=new F.CacheOffline({sandbox:"6-hr-cache"});this.set("cache",H);},getData:function(I){var H=this,J=I[0].retrieve;if(J){H.get(C)[J].getData(I);H.get(C)[J].addTarget(I[0].model);}else{F.each(H.get(C),function(K){K.getData(I);});H.set(G,0);}},resetList:function(){this.get(B).reset();},saveSearchResult:function(I){var H=this,K=I.filter,J={key:"1",text:H.createSearchText(K),value:I.result,filter:K,date:new Date()};H.get("latestSearch").add(J);},createSearchKey:function(I){var H="";F.each(I,function(J){H+=J.attr+"="+J.value+"&";});return H;},createSearchText:function(I){var H="",K="",J="";F.each(I,function(L){if(L.attr==="text"){K=L.value;}if(L.attr==="category"){J=L.value;}});if(K!==""){H=K+" en ";if(J!==""){H+=J+".";}else{H+="todo el sitio.";}}else{if(J!==""){H=J;}}return H;},addInterest:function(H){this.get(D).add(H);},notInterest:function(I){var H=this;H.get(D).remove(I);H.get(D).save();},more:function(){var H=this;F.each(H.get(C),function(I){I.more();});},tags:function(J){var H=this,I={},K=H.get(A).getAttr(J);I=H.get(A).walkToRoot(K,I,"tags");return I;}},{ATTRS:{retrieve:{value:[]},loadedData:{value:[]},latestSearch:{value:[]},interest:{value:[]},cache:{value:{}},search:{value:{total:0}},literal:{value:{}}}});F.AquiNaMa.DataController=E;},"@VERSION@",{skinnable:false,requires:["base","event","cache-offline","model","aquinama-articlelist","aquinama-searchlist","aquinama-revolretrieve","aquinama-cubretrieve","aquinama-literal"]});