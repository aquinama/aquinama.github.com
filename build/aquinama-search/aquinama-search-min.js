YUI.add("aquinama-search",function(D){D.namespace("AquiNaMa");var C="contentBox",A=D.Base.create("aquinama-filter",D.Base,[D.AutoCompleteBase],{initializer:function(){var E=this;E.set("resultFilters",E.customFilter);E.set("resultHighlighter",E.customHighlighter);E._bindUIACBase();E._syncUIACBase();},customFilter:function(J,I){var E=this,K,H=E.get("afilter"),G,F;K=D.AutoCompleteFilters.subWordMatch(J,I);D.each(H,function(L){if(L){G=L.filter;if(L.hasOwnProperty("filter")){K=E[G.name](L,K,G.params);}F=L.alias;if(F.length==0){K=E.orFilter("",K);}else{K=E.orFilter(F,K);}}});return K;},orFilter:function(H,F){var J=this,L,E,I,M=H.length,G,K;L=D.Array.filter(F,function(N){E=false;K=N.text;if(D.Lang.isArray(H)){for(G=0;G<M;G++){I=K.toLowerCase().indexOf(H[G]);if(I!==-1){E=true;break;}}return E;}else{return K.toLowerCase().indexOf(H)!==-1;}});return L;},nofreeFilter:function(F,E,G){return this.priceFilter(F,E,G);},priceFilter:function(K,H,E){var N=[],L,F=E.min,M=E.max,P=H.length,G=0,O,I,J;if(!F){F=0;}for(;G<P;G++){I=H[G];J=I.raw.model.get("price");L=0;if(J>=F){L=1;if(M&&J>=M){L=0;}}if(L){N.push(I);}}return N;},imageFilter:function(J,G,E){var L=[],K,N=G.length,H=0,M,I,F;for(;H<N;H++){I=G[H];F=I.raw.model.get("picture");if(F){L.push(I);}}return L;},afilterPopulate:function(H){var E=this,G=E.get("afilter"),F=H.name;if(G.hasOwnProperty(F)&&G[F]!=""){delete G[F];}else{G[F]=E.get("tags")[F];}E.set("afilter",G);},customHighlighter:function(K,I){var F=[],E,L,H=I.length,J,G=0;L=this.concatAll(K);for(;G<H;G++){J=I[G];E=D.Highlight.all(J.text,L);J.raw.model.set("highlight",E);F.push(E);}return F;},concatAll:function(F){var E=this,G=[];D.each(E.get("afilter"),function(H){G=G.concat(H.alias);});F=F.split(" ");G=G.concat(F);return G;},clear:function(){var E=this;E.set("afilter",{});E.set("value","");E.set("tags",{});}},{ATTRS:{afilter:{value:{}},tags:{value:[]}}}),B=D.Base.create("aquinama-search",D.Widget,[],{initializer:function(){var E=this;E._publishEvents();},renderUI:function(){var E=this,F=E.get(C);F.one(".yui3-aquinama-search-category-list").appendChild(E._renderCategorys("0"));F.all(".yui3-aquinama-search-category-list > ul > li").addClass("yui3-aquinama-search-float");},bindUI:function(){var E=this,F=E.get(C);F.one(".yui3-aquinama-search-all").on("click",E._handlerClickAll,E);F.one(".yui3-aquinama-search-text").on("focus",E._handlerFocusSearch,E);F.one(".yui3-aquinama-search-form").on("submit",E._handlerSubmit,E);F.all("div.yui3-aquinama-search-item").on("click",E._handlerClickCategory,E);F.one(".yui3-aquinama-search-close").on("click",E._handlerCloseAll,E);F.on("clickoutside",E._hideCategoryMenu,E);E.on("aselectChange",function(G){if(G.newVal!=="Me Interesan"&&G.newVal){E.set("lastaselect",G.newVal);}});},syncUI:function(){var E=this,F=E.get(C);E._createAC();E._syncSearch();F.one(".yui3-aquinama-search-text").focus();},_publishEvents:function(){var E=this;E.publish("search",{emitFacade:true,broadcast:1});E.publish("clear",{emitFacade:true,broadcast:1});},_renderCategorys:function(G){var E=this,F=E.get("acategorys"),J=D.Node.create('<li><div class="yui3-aquinama-search-item" data-tags="'+G+'">'+F[G].name+"</div></li>"),I=D.Node.create("<ul></ul>"),H=F[G].childers;D.each(H,function(K){I.appendChild(E._renderCategorys(K));});if(G!="0"){J.appendChild(I);return J;}return I;},_createAC:function(){var E=this,F=E.get(C),I=E.get("acategorys"),H=F.one(".yui3-aquinama-search-text"),J='{name}<span class="yui3-aquinama-ac-suggest"> - Ver Categoria</span>';function G(L,K){return D.Array.map(K,function(M){var N=M.raw;return D.Lang.sub(J,{name:M.highlighted});});}H.plug(D.Plugin.AutoComplete,{resultFilters:"subWordMatch",resultHighlighter:"subWordMatch",resultFormatter:G,minQueryLength:0,queryDelay:0,resultTextLocator:"tags",maxResults:15,source:E._acSource()});H.ac.after("select",E._handlerResultAC,E);E.set("ac",H);},_acSource:function(){var F=this,G=F.get("acategorys"),E=[];D.each(G,function(H){if(H.id!="0"&&H.id!="1"&&H.id!="2"){E.push({tags:H.name,id:H.id});}});return E;},_createBreadcrumb:function(L){var J=this,H=J.get(C),F=J.get("acategorys"),M,K=L,I,E=[],G;if(F[L]){K=F[L].name;I=F[L].parent;if(I&&I!=="0"){E.push({text:F[I].name,item:F[I].id});}E.push({text:K,item:L});}else{E.push({text:K,item:K});}G=H.one(".yui3-aquinama-search-category-filter");D.each(E,function(N){M=D.Node.create('<li data-tags="'+N.item+'" class="yui3-aquinama-search-category ">'+N.text+'<div class="yui3-aquinama-search-close-cat" title="Cerrar categor&iacute;a"></div></li>');M.one("div").on("click",J._handlerCloseCategoryItem,J);M.on("click",J._handlerClickCategoryItem,J);G.appendChild(M);});},_handlerClickAll:function(E){this._showCategory();},_handlerFocusSearch:function(G){var E=this,F=E.get("ac");F.set("value","");E._hideCategoryMenu();},_handlerSubmit:function(H){var F=this,G=F.get(C),I=G.one(".yui3-aquinama-search-text").get("value"),E;H.preventDefault();if(D.Lang.isValue(I)&&D.Lang.trim(I)!=""){F.set("aselect",I);}E=F.get("aselect");if(E){F._clearSearch();F.set("aselect",E);F._createBreadcrumb(E);F._search();F._syncSearch();}},_handlerClickCategory:function(F){var E=this;E._hideCategoryMenu();E.searchCategory(F.target.getAttribute("data-tags"));},_handlerClickCategoryItem:function(F){var E=this;E.searchCategory(F.target.getAttribute("data-tags"));},searchCategory:function(F){var E=this;E._clearSearch();E.set("aselect",F);E._createBreadcrumb(F);E._syncSearch();E._search();},_handlerCloseCategoryItem:function(I){var E=this,F=E.get(C),H=E.get("acategorys"),G=H[I.target.get("parentNode").getAttribute("data-tags")];if(G&&G.parent!="0"){G=G.parent;E._clearSearch();E.set("aselect",G);E._createBreadcrumb(G);E._search();}else{E._clearSearch();E.fire("aquinama-search:clear",{});}E._syncSearch();},_handlerCloseAll:function(E){this._clearSearch();this._syncSearch();this.fire("aquinama-search:clear",{});},_handlerResultAC:function(E){this.setupSearch(E.itemNode._data.result.raw.id);},setupSearch:function(I){var E=this,F=E.get(C),G=E.get("acategorys"),H=I;
E._clearSearch();E.set("aselect",H);E._createBreadcrumb(H);E._syncSearch();E._search();},_handlerClickAdvanced:function(F){var E=this;E._showAdvanced();},clearSearch:function(){this._clearSearch();this._syncSearch();},_showCategory:function(F){var E=this,G=E.get("contentBox").one(".yui3-aquinama-search-category-list");G.removeClass("yui3-aquinama-hidden");},_hideCategoryMenu:function(G){var E=this,F=E.get("ac"),H=E.get("contentBox").one(".yui3-aquinama-search-category-list");H.addClass("yui3-aquinama-hidden");},_showAdvanced:function(F){var E=this,G=E.get("contentBox").one(".yui3-aquinama-search-advanced-list");G.removeClass("yui3-aquinama-hidden");},_hideAdvanced:function(G){var E=this,F=E.get("ac"),H=E.get("contentBox").one(".yui3-aquinama-search-advanced-list");H.addClass("yui3-aquinama-hidden");},_search:function(){var F=this,G=F.get(C),I=F.get("ac"),J=F.get("acategorys"),H=[],E=F.get("aselect");if(J[E]){H.push({attr:"category",value:E});}else{if(E){H.push({attr:"text",value:E});}}G.one(".yui3-aquinama-search-text").addClass("yui3-aquinama-hidden");G.one(".yui3-aquinama-search-filter").removeClass("yui3-aquinama-hidden");G.one(".yui3-aquinama-search-close").removeClass("yui3-aquinama-hidden");G.one(".yui3-aquinama-search-filter").set("value","");F.fire("aquinama-search:search",{filter:H});},_syncSearch:function(){var G=this,H=G.get(C),J=G.get("ac"),K=H.one(".yui3-aquinama-search-filter"),I=H.one(".yui3-aquinama-search-text"),F=H.one(".yui3-aquinama-search-category-filter").get("offsetWidth"),E=H.get("offsetWidth");H.one(".yui3-aquinama-search-text").setStyle("width",E-210-F);H.one(".yui3-aquinama-search-filter").setStyle("width",E-210-F);H.one(".yui3-aclist").setStyle("width",E-210-F);K.set("value","");J.ac.set("value","");},_clearSearch:function(){var E=this,F=E.get(C),H=F.one(".yui3-aquinama-search-filter"),G=F.one(".yui3-aquinama-search-text");F.one(".yui3-aquinama-search-category-filter").empty();G.set("value","");H.set("value","");E.set("aselect",null);H.addClass("yui3-aquinama-hidden");G.removeClass("yui3-aquinama-hidden");F.one(".yui3-aquinama-search-close").addClass("yui3-aquinama-hidden");},setCategory:function(G){var E=this,F=E.get(C);E._clearSearch();E._createBreadcrumb(G);E.set("aselect",G);E._syncSearch();F.one(".yui3-aquinama-search-text").addClass("yui3-aquinama-hidden");F.one(".yui3-aquinama-search-filter").removeClass("yui3-aquinama-hidden");F.one(".yui3-aquinama-search-close").removeClass("yui3-aquinama-hidden");}},{ATTRS:{acategorys:{value:null},aselect:{value:null},ac:{value:null},lastaselect:{value:null}}});D.AquiNaMa.Filter=A;D.AquiNaMa.Search=B;},"@VERSION@",{skinnable:true,requires:["widget","autocomplete","autocomplete-filters","autocomplete-highlighters","arraylist-add","event-outside"]});