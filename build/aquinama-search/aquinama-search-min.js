YUI.add("aquinama-search",function(D){D.namespace("AquiNaMa");var C="contentBox",A=D.Base.create("aquinama-filter",D.Base,[D.AutoCompleteBase],{initializer:function(){var E=this;E.set("resultFilters",E.customFilter);E.set("resultHighlighter",E.customHighlighter);E._bindUIACBase();E._syncUIACBase();},customFilter:function(G,F){var E=this,H;H=D.AutoCompleteFilters.subWordMatch(G,F);D.each(E.get("afilter"),function(I){if(I){if(I.hasOwnProperty("filter")){H=E[I.filter](I,H);}H=E.orFilter(I.alias,H);}});return H;},orFilter:function(J,I){var F=this,G,E,H;G=D.Array.filter(I,function(K){E=false;if(D.Lang.isArray(J)){for(var L=0;L<J.length;L++){H=K.text.toLowerCase().indexOf(J[L]);if(H!==-1){E=true;break;}}return E;}else{return K.text.toLowerCase().indexOf(J)!==-1;}});return G;},priceFilter:function(I,H){var F,E,G;F=D.Array.filter(H,function(J){return J.raw.model.get("price")!==0;});return F;},afilterPopulate:function(H){var E=this,G=E.get("afilter"),F;if(G.hasOwnProperty(H.name)&&G[H.name]!=""){delete G[H.name];}else{G[H.name]=E.get("tags")[H.name];}E.set("afilter",G);},customHighlighter:function(I,H){var F=this,G,E,J;J=F.concatAll(I);G=D.Array.map(H,function(K){E=D.Highlight.all(K.text,J);return E;});return G;},concatAll:function(F){var E=this,G=[];D.each(E.get("afilter"),function(H){G=G.concat(H.alias);});F=F.split(" ");G=G.concat(F);return G;},clear:function(){var E=this;E.set("afilter",{});E.set("value","");E.set("tags",{});}},{ATTRS:{afilter:{value:{}},tags:{value:[]}}}),B=D.Base.create("aquinama-search",D.Widget,[],{CONTENT_TEMPLATE:"<div>"+'<div data-tags="Todo" class="yui3-aquinama-search-all">Todo</div>'+'<ul class="yui3-aquinama-search-category-filter">'+"</ul>"+'<input class="yui3-aquinama-search-filter yui3-aquinama-input-text yui3-aquinama-hidden" type="text" placeholder="Filtar"/>'+'<form class="yui3-aquinama-search-form yui3-skin-sam" action="#">'+'<input class="yui3-aquinama-search-text yui3-aquinama-input-text" type="text" placeholder="Buscar"/>'+'<div class="yui3-aquinama-search-close yui3-aquinama-hidden"></div>'+'<button type="submit" class="yui3-aquinama-search-button yui3-aquinama-button-up">Buscar</button>'+'<img src="assets/images/glade.png" width="34" class="yui3-aquinama-search-advanced">'+"</form>"+'<div class="yui3-aquinama-clear"></div>'+'<div class="yui3-aquinama-search-category-list yui3-aquinama-hidden"></div>'+"</div>",initializer:function(){var E=this;E._publishEvents();},renderUI:function(){var E=this,F=E.get(C);F.one(".yui3-aquinama-search-category-list").appendChild(E._renderCategorys("revolico"));F.all(".yui3-aquinama-search-category-list > ul > li").addClass("yui3-aquinama-search-float");},bindUI:function(){var E=this,F=E.get(C);F.one(".yui3-aquinama-search-all").on("click",E._handlerClickAll,E);F.one(".yui3-aquinama-search-text").on("focus",E._handlerFocusSearch,E);F.one(".yui3-aquinama-search-form").on("submit",E._handlerSubmit,E);F.all(".yui3-aquinama-search-item").on("click",E._handlerClickCategory,E);F.all(".yui3-aquinama-search-category").on("click",E._handlerClickCategoryItem,E);F.one(".yui3-aquinama-search-close").on("click",E._handlerCloseAll,E);F.on("clickoutside",E._hideCategory,E);},syncUI:function(){var E=this,F=E.get(C);E._createAC();E._syncSearch();F.one(".yui3-aquinama-search-text").focus();},_publishEvents:function(){var E=this;E.publish("search",{emitFacade:true,broadcast:1});E.publish("clear",{emitFacade:true,broadcast:1});},_renderCategorys:function(G){var E=this,F=E.get("acategorys"),I=D.Node.create('<li><div class="yui3-aquinama-search-item" data-tags="'+G+'">'+F[G].name+"</div></li>"),H=D.Node.create("<ul></ul>");E._craeteViewFilter("Todo");D.each(F[G].childers,function(J){H.appendChild(E._renderCategorys(J));});if(G!="revolico"){I.appendChild(H);return I;}return H;},_createAC:function(){var E=this,F=E.get(C),I=E.get("acategorys"),H=F.one(".yui3-aquinama-search-text"),J='{name}<span class="yui3-aquinama-ac-suggest"> - Ver Categoria</span>';function G(L,K){return D.Array.map(K,function(M){var N=M.raw;return D.Lang.sub(J,{name:M.highlighted});});}H.plug(D.Plugin.AutoComplete,{resultFilters:"subWordMatch",resultHighlighter:"subWordMatch",resultFormatter:G,minQueryLength:0,queryDelay:0,resultTextLocator:"tags",maxResults:15,source:E._acSource()});H.ac.after("select",E._handlerResultAC,E);E.set("ac",H);},_acSource:function(){var F=this,G=F.get("acategorys"),E=[];D.each(G,function(H){if(H.id!="revolico"){E.push({tags:H.name,id:H.id});}});return E;},_craeteViewFilter:function(G){var F=this,H=F.get("acategorys"),E;if(!H[G]){E=D.Node.create('<li data-tags="'+G+'" class="yui3-aquinama-search-category ">'+G+'<div class="yui3-aquinama-search-close-cat"></div></li>');E.one("div").on("click",F._handlerCloseCategoryItem,F);return E;}E=D.Node.create('<li data-tags="'+G+'" class="yui3-aquinama-search-category">'+H[G].name+'<div class="yui3-aquinama-search-close-cat"></div></li>');E.one("div").on("click",F._handlerCloseCategoryItem,F);if(H[G].parent=="revolico"){E.on("click",F._handlerClickCategoryItem,F);}return E;},_handlerClickAll:function(E){this._showCategory();},_handlerFocusSearch:function(G){var E=this,F=E.get("ac");F.set("value","");E._hideCategory();},_handlerFocusFilter:function(E){},_handlerSubmit:function(G){var E=this,F=E.get(C),H=F.one(".yui3-aquinama-search-text").get("value");G.preventDefault();if(D.Lang.isValue(H)&&D.Lang.trim(H)!=""){F.one(".yui3-aquinama-search-category-filter").appendChild(E._craeteViewFilter(H));E.set("aselect",H);E._search();E._syncSearch();}},_handlerClickCategory:function(H){var E=this,F=E.get(C),G=E.get("acategorys"),I=H.target.getAttribute("data-tags");E._hideCategory();E._clearSearch();E.set("aselect",I);if(G[I].parent=="revolico"){F.one(".yui3-aquinama-search-category-filter").appendChild(E._craeteViewFilter(I));}else{F.one(".yui3-aquinama-search-category-filter").appendChild(E._craeteViewFilter(G[I].parent));F.one(".yui3-aquinama-search-category-filter").appendChild(E._craeteViewFilter(I));}E._syncSearch();
E._search();},_handlerCloseCategoryItem:function(I){var E=this,F=E.get(C),H=E.get("acategorys"),G=H[I.target.get("parentNode").getAttribute("data-tags")];if(G&&G.parent!="revolico"){G=G.parent;E._clearSearch();E.set("aselect",G);F.one(".yui3-aquinama-search-category-filter").appendChild(E._craeteViewFilter(G));E._search();}else{E._clearSearch();E.fire("aquinama-search:clear",{});}E._syncSearch();},_handlerClickCategoryItem:function(H){var E=this,F=E.get(C),G=H.target.getAttribute("data-tags");E._clearSearch();E.set("aselect",G);F.one(".yui3-aquinama-search-category-filter").appendChild(E._craeteViewFilter(G));E._search();E._syncSearch();},_handlerCloseAll:function(E){this._clearSearch();this._syncSearch();this.fire("aquinama-search:clear",{});},_handlerResultAC:function(H){var E=this,F=E.get(C),G=E.get("acategorys"),I=H.itemNode._data.result.raw.id;E._clearSearch();E.set("aselect",I);if(G[I].parent=="revolico"){F.one(".yui3-aquinama-search-category-filter").appendChild(E._craeteViewFilter(I));}else{F.one(".yui3-aquinama-search-category-filter").appendChild(E._craeteViewFilter(G[I].parent));F.one(".yui3-aquinama-search-category-filter").appendChild(E._craeteViewFilter(I));}E._search();E._syncSearch();},clearSearch:function(){this._clearSearch();this._syncSearch();},_showCategory:function(F){var E=this,G=E.get("contentBox").one(".yui3-aquinama-search-category-list");G.removeClass("yui3-aquinama-hidden");},_hideCategory:function(G){var E=this,F=E.get("ac"),H=E.get("contentBox").one(".yui3-aquinama-search-category-list");H.addClass("yui3-aquinama-hidden");},_search:function(){var E=this,F=E.get(C),I=E.get("ac"),J=E.get("acategorys"),K=F.one(".yui3-aquinama-search-text").get("value"),G=[],H=E.get("aselect");if(J[H]){G.push({attr:"category",value:H});}if(K!==""){G.push({attr:"text",value:K});}F.one(".yui3-aquinama-search-text").addClass("yui3-aquinama-hidden");F.one(".yui3-aquinama-search-filter").removeClass("yui3-aquinama-hidden");F.one(".yui3-aquinama-search-close").removeClass("yui3-aquinama-hidden");F.one(".yui3-aquinama-search-filter").set("value","");E.fire("aquinama-search:search",{filter:G});},_syncSearch:function(){var G=this,H=G.get(C),J=G.get("ac"),K=H.one(".yui3-aquinama-search-filter"),I=H.one(".yui3-aquinama-search-text"),F=H.one(".yui3-aquinama-search-category-filter").get("offsetWidth"),E=H.get("offsetWidth");H.one(".yui3-aquinama-search-text").setStyle("width",E-210-F);H.one(".yui3-aquinama-search-filter").setStyle("width",E-210-F);H.one(".yui3-aclist").setStyle("width",E-210-F);K.set("value","");J.ac.set("value","");},_clearSearch:function(){var E=this,F=E.get(C),H=F.one(".yui3-aquinama-search-filter"),G=F.one(".yui3-aquinama-search-text");F.one(".yui3-aquinama-search-category-filter").empty();G.set("value","");H.set("value","");E.set("aselect",null);H.addClass("yui3-aquinama-hidden");G.removeClass("yui3-aquinama-hidden");F.one(".yui3-aquinama-search-close").addClass("yui3-aquinama-hidden");},setCategory:function(G){var E=this,F=E.get(C);E._clearSearch();F.one(".yui3-aquinama-search-category-filter").appendChild(E._craeteViewFilter(G));E.set("aselect",G);E._syncSearch();F.one(".yui3-aquinama-search-text").addClass("yui3-aquinama-hidden");F.one(".yui3-aquinama-search-filter").removeClass("yui3-aquinama-hidden");F.one(".yui3-aquinama-search-close").removeClass("yui3-aquinama-hidden");}},{ATTRS:{acategorys:{value:null},aselect:{value:null},ac:{value:null}}});D.AquiNaMa.Filter=A;D.AquiNaMa.Search=B;},"@VERSION@",{skinnable:true,requires:["widget","autocomplete","autocomplete-filters","autocomplete-highlighters","arraylist-add","event-outside"]});